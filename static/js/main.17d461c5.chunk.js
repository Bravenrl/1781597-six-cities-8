(this.webpackJsonpproject=this.webpackJsonpproject||[]).push([[0],{76:function(e,t,a){"use strict";a.r(t);var r,n,c,i=a(1),s=a.n(i),o=a(19),l=a.n(o),u=a(2),d=a(5);!function(e){e.Root="/",e.Login="/login",e.Favorites="/favorites",e.RoomProprety="/offer/:id",e.NotFound="/notfound"}(r||(r={})),function(e){e.Auth="AUTH",e.NoAuth="NO_AUTH",e.Unknown="UNKNOWN"}(n||(n={})),function(e){e.Main="cities",e.Favorites="favorites",e.Property="near-places"}(c||(c={}));var j;!function(e){e.Popular="Popular",e.PriceToHight="Price: low to high",e.PriceToLow="Price: high to low",e.TopRated="Top rated first"}(j||(j={}));var p,b=new Map([["Paris",{name:"Paris",location:{latitude:48.85661,longitude:2.351499,zoom:13}}],["Cologne",{name:"Cologne",location:{latitude:50.938361,longitude:6.959974,zoom:13}}],["Brussels",{name:"Brussels",location:{latitude:50.846557,longitude:4.351697,zoom:13}}],["Amsterdam",{name:"Amsterdam",location:{latitude:52.37454,longitude:4.897976,zoom:13}}],["Hamburg",{name:"Hamburg",location:{latitude:53.550341,longitude:10.000654,zoom:13}}],["Dusseldorf",{name:"Dusseldorf",location:{latitude:51.225402,longitude:6.776314,zoom:13}}]]),f=/(?=.*[0-9])(?=.*[a-z])[0-9a-z]{2,}/,m=/.+@.+\..+/i,O=new Map([[5,"perfect"],[4,"good"],[3,"not bad"],[2,"badly"],[1,"terribly"]]),h="",v=0;!function(e){e[e.add=1]="add",e[e.delete=0]="delete"}(p||(p={}));var _;!function(e){e.LoginEmail="email",e.LoginPassword="password",e.LoginButton="button",e.LoginLink="link",e.MapSection="map",e.OfferListDiv="offer",e.ButtonSvg="svg",e.Option="span"}(_||(_={}));var x,g={MainPage:new RegExp("Cities","i"),LoginEmail:new RegExp("E-mail","i"),LoginPassword:new RegExp("Password","i"),PropertyPage:new RegExp("Meet the host","i"),FavoritePage:new RegExp("Saved listing","i"),BackToRoot:new RegExp("\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e","i"),NotFoundPage:new RegExp("404. Page not found","i"),LoginButton:new RegExp("Sign in","i"),Preloader:new RegExp("Loading","i"),PlaceAltText:new RegExp("Place","i"),Root:new RegExp("root","i"),FakeCity:new RegExp("Paris","i"),NonExpectCity:new RegExp("Cologne","i"),LogoAltText:new RegExp("6 cities logo","i"),SignOut:new RegExp("Sign out","i"),SignIn:new RegExp("Sign in","i"),Favorite:new RegExp("favorite","i"),Property:new RegExp("property","i"),PremiumMark:new RegExp("Premium","i"),Login:new RegExp("login","i"),ImgAltText:new RegExp("Studio","i"),AvatarAltText:new RegExp("Reviews avatar","i"),RatingText:new RegExp("Rating","i"),ReviewsText:new RegExp("Reviews","i"),ButtonIsFavorite:new RegExp("In bookmarks","i"),ButtonNonFavorite:new RegExp("To bookmarks","i"),FavoriteEmptyFirst:new RegExp("Nothing yet saved","i"),FavoriteEmptySecond:new RegExp("Save properties to narrow down","i"),OptionText:new RegExp("Sort by","i")},y=("".concat(g.Root),"".concat(g.Favorite),"".concat(g.Property),"".concat(g.Login),a(7)),N=a(24),w=a(16),R=a(3);!function(e){e.isLoading="app/isLoading",e.isPosting="app/isPosting",e.RedirectToRoute="app/redirectToRoute",e.HistoryBack="app/historyBack",e.AddComment="data/addComment",e.AddCommentRating="data/addCommentRating",e.LoadOffers="data/loadOffers",e.LoadFavoriteOffers="data/loadFavoriteOffers",e.LoadReviews="data/loadReviews",e.LoadCurrentOffer="data/loadCurrentOffer",e.LoadNearbyOffers="data/loadNearbyOffers",e.UserEmail="data/setUserEmail",e.ChangeIsFavorite="data/changeIsFavorite",e.RemoveFavoriteOffers="data/removeIsFavorite",e.RemoveCurrentOffer="dara/removeCurrentOffer",e.RequireAuthorization="user/requireAuthorization",e.ChangeCity="user/changeCity",e.RequireLogout="user/requireLogout",e.ChangeSorting="user/changeSorting",e.SetCurrentId="user/setCurrentId",e.ToggleIsFavorite="user/toggleIsFavorite"}(x||(x={}));var k,P,F=Object(R.b)(x.ChangeCity,(function(e){return{payload:e}})),C=Object(R.b)(x.LoadOffers,(function(e){return{payload:e}})),L=Object(R.b)(x.ChangeSorting,(function(e){return{payload:e}})),E=Object(R.b)(x.isLoading,(function(e){return{payload:e}})),T=Object(R.b)(x.RequireAuthorization,(function(e){return{payload:e}})),S=Object(R.b)(x.RequireLogout,(function(){return{payload:n.NoAuth}})),A=Object(R.b)(x.UserEmail,(function(e){return{payload:e}})),I=Object(R.b)(x.RedirectToRoute,(function(e){return{payload:e}})),M=Object(R.b)(x.LoadCurrentOffer,(function(e){return{payload:e}})),z=Object(R.b)(x.LoadNearbyOffers,(function(e){return{payload:e}})),U=Object(R.b)(x.LoadReviews,(function(e){return{payload:e}})),B=Object(R.b)(x.HistoryBack),q=Object(R.b)(x.isPosting,(function(e){return{payload:e}})),D=Object(R.b)(x.AddComment,(function(e){return{payload:e}})),H=Object(R.b)(x.AddCommentRating,(function(e){return{payload:e}})),Y=Object(R.b)(x.SetCurrentId,(function(e){return{payload:e}})),W=Object(R.b)(x.LoadFavoriteOffers,(function(e){return{payload:e}})),K=Object(R.b)(x.ChangeIsFavorite,(function(e){return{payload:e}})),J=Object(R.b)(x.ToggleIsFavorite,(function(e,t){return{payload:{isFavorite:e,id:t}}})),G=Object(R.b)(x.RemoveCurrentOffer),X=Object(R.b)(x.RemoveFavoriteOffers),Q={offers:[],userEmail:"",currentOffer:{},nearbyOffers:[],reviews:[],comment:h,commentRating:v,favoriteOffers:[],currentIsFavorite:null},V=Object(R.c)(Q,(function(e){e.addCase(C,(function(e,t){e.offers=t.payload})).addCase(A,(function(e,t){e.userEmail=t.payload})).addCase(M,(function(e,t){e.currentOffer=t.payload})).addCase(z,(function(e,t){e.nearbyOffers=t.payload})).addCase(U,(function(e,t){e.reviews=t.payload})).addCase(D,(function(e,t){e.comment=t.payload})).addCase(H,(function(e,t){e.commentRating=t.payload})).addCase(W,(function(e,t){e.favoriteOffers=t.payload})).addCase(K,(function(e,t){var a=t.payload;e.favoriteOffers.length>0&&(e.favoriteOffers=e.favoriteOffers.filter((function(e){return e.id!==a.id}))),e.offers=e.offers.map((function(e){return e.id===a.id&&(e.isFavorite=a.isFavorite),e}))})).addCase(J,(function(e,t){var a=t.payload,r=a.id,n=a.isFavorite;e.currentIsFavorite=e.currentOffer.id===r?n:null})).addCase(X,(function(e){e.favoriteOffers=[]})).addCase(G,(function(e){e.currentOffer={},e.nearbyOffers=[],e.currentIsFavorite=null,e.reviews=[]}))})),Z=Object(R.c)({isLoading:!1,isPosting:!1},(function(e){e.addCase(E,(function(e,t){e.isLoading=t.payload})).addCase(q,(function(e,t){e.isPosting=t.payload}))})),$={city:"Paris",sortType:j.Popular,authorizationStatus:n.Unknown,currentId:null},ee=Object(R.c)($,(function(e){e.addCase(F,(function(e,t){e.city=t.payload})).addCase(L,(function(e,t){e.sortType=t.payload})).addCase(T,(function(e,t){e.authorizationStatus=t.payload})).addCase(S,(function(e,t){e.authorizationStatus=t.payload})).addCase(Y,(function(e,t){e.currentId=t.payload}))}));!function(e){e.app="APP",e.data="DATA",e.user="USER"}(P||(P={}));var te=Object(w.c)((k={},Object(N.a)(k,P.app,Z),Object(N.a)(k,P.data,V),Object(N.a)(k,P.user,ee),k)),ae=function(e){return e[P.app].isLoading},re=function(e){return e[P.app].isPosting},ne=a(0);var ce=function(){var e=Object(u.c)(re),t=Object(u.c)(ae);return e||t?Object(ne.jsx)("div",{style:{position:"fixed",top:"200px",left:"35%",width:"30%",height:"30%",display:"flex",alignItems:"center",justifyContent:"center"},children:Object(ne.jsx)("img",{src:"img/loading.svg",alt:"Loading"})}):null};var ie,se,oe,le=function(e){return function(t){return Object(ne.jsxs)(ne.Fragment,{children:[l.a.createPortal(Object(ne.jsx)(ce,{}),document.body),Object(ne.jsx)(e,Object(y.a)({},t))]})}},ue=function(e){return e[P.user].city},de=function(e){return e[P.user].sortType},je=function(e){return e[P.user].authorizationStatus},pe=function(e){return e[P.user].currentId},be=a(6),fe=a(8),me=a.n(fe),Oe=a(18),he=a(26),ve=a.n(he),_e=a(13),xe=a(22),ge=["is_pro","avatar_url"],ye=["is_favorite","is_premium","max_adults","preview_image","host"],Ne=["user"],we=["email","token"],Re=function(e){var t=e.is_pro,a=e.avatar_url,r=Object(xe.a)(e,ge);return Object(y.a)(Object(y.a)({},r),{},{isPro:t,avatarUrl:a})},ke=function(e){var t=e.is_favorite,a=e.is_premium,r=e.max_adults,n=e.preview_image,c=e.host,i=Object(xe.a)(e,ye);return Object(y.a)(Object(y.a)({},i),{},{isFavorite:t,isPremium:a,maxAdults:r,previewImage:n,host:Re(c)})},Pe=function(e){var t=e.user,a=Object(xe.a)(e,Ne);return Object(y.a)(Object(y.a)({},a),{},{user:Re(t)})},Fe=function(e){var t=e.email,a=e.token,r=Object(xe.a)(e,we);return Object(y.a)(Object(y.a)({},Re(r)),{},{email:t,token:a})},Ce="six-cities-token";!function(e){e.Offers="/hotels",e.Login="/login",e.Logout="/logout",e.NearbyOffers="/nearby",e.Reviews="/comments",e.Favorite="/favorite"}(ie||(ie={})),function(e){e[e.Unauthorised=401]="Unauthorised",e[e.NotFound=404]="NotFound",e[e.BadRequest=400]="BadRequest",e[e.OK=200]="OK"}(se||(se={})),function(e){e.Unauthorised="log in, please",e["\u0412adRequest"]="request error, check the entered data",e.NotFound="data not available",e.NetworkErr="network error",e.LoadFiail="failed data loading"}(oe||(oe={}));var Le=function(e){void 0===e&&_e.b.error(oe.NetworkErr),e===se.Unauthorised&&_e.b.warning(oe.Unauthorised),e===se.BadRequest&&_e.b.warning(oe.\u0412adRequest),e===se.NotFound&&_e.b.warning(oe.NotFound)},Ee=function(e){return localStorage.setItem(Ce,e)},Te=a(9),Se=a(17),Ae=function(e){return e[0].toUpperCase()+e.slice(1)},Ie=function(e){return e[P.data].userEmail},Me=function(e){return e[P.data].currentOffer},ze=function(e){return e[P.data].nearbyOffers},Ue=function(e){return e[P.data].comment},Be=function(e){return e[P.data].commentRating},qe=function(e){return e[P.data].favoriteOffers},De=function(e){return e[P.data].currentIsFavorite},He=Object(Se.a)([function(e){return e[P.data].offers},ue],(function(e,t){return e.filter((function(e){return e.city.name===t}))})),Ye=Object(Se.a)([function(e){return e[P.data].reviews}],(function(e){return Object(Te.a)(e).sort((function(e,t){return Date.parse(t.date)-Date.parse(e.date)})).slice(0,10)})),We=Object(Se.a)([ze,Me],(function(e,t){return[].concat(Object(Te.a)(e),[t])})),Ke=Object(Se.a)([He,de],(function(e,t){switch(t){case j.PriceToHight:return Object(Te.a)(e).sort((function(e,t){return e.price-t.price}));case j.PriceToLow:return Object(Te.a)(e).sort((function(e,t){return t.price-e.price}));case j.TopRated:return Object(Te.a)(e).sort((function(e,t){return t.rating-e.rating}));default:return e}}));var Je=function(){return Object(ne.jsxs)("section",{className:"favorites favorites--empty",children:[Object(ne.jsx)("h1",{className:"visually-hidden",children:"Favorites (empty)"}),Object(ne.jsxs)("div",{className:"favorites__status-wrapper",children:[Object(ne.jsx)("b",{className:"favorites__status",children:"Nothing yet saved."}),Object(ne.jsx)("p",{className:"favorites__status-description",children:"Save properties to narrow down search or plan your future trips."})]})]})},Ge={button:"property__bookmark-button",icon:"property__bookmark-icon",active:"property__bookmark-button--active"},Xe={button:"place-card__bookmark-button",icon:"place-card__bookmark-icon",active:"place-card__bookmark-button--active"},Qe="cities__map",Ve="property__map",Ze="cities__places-list places__list tabs__content",$e="favorites__places",et="near-places__list places__list",tt="cities__place-card place-card",at="favorites__card place-card",rt="near-places__card place-card",nt="place-card__mark",ct="property__mark";var it=function(e){var t=e.pageType;return Object(ne.jsx)("div",{className:t===c.Property?ct:nt,children:Object(ne.jsx)("span",{children:"Premium"})})},st=a(20);var ot=function(e){var t=e.id,a=e.isFavorite,s=e.pageType,o=Object(u.c)(De),l=Object(u.c)(je),d=Object(u.b)(),j=s===c.Property?o:a,p=Object(i.useState)(!1),b=Object(st.a)(p,2),f=b[0],m=b[1];return Object(i.useEffect)((function(){m(!1)}),[j]),Object(ne.jsxs)("button",{className:"".concat(s===c.Property?Ge.button:Xe.button,"\n    ").concat(j&&"".concat(s===c.Property?Ge.active:Xe.active),"\n    button"),type:"button",disabled:f,onClick:function(e){e.preventDefault(),l!==n.Auth?d(I(r.Login)):(d(function(e,t){return function(){var a=Object(Oe.a)(me.a.mark((function a(r,n,c){return me.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r(q(!0)),a.next=3,c.post("".concat(ie.Favorite,"/").concat(t,"/").concat(e)).then((function(e){var t=ke(e.data);r(K(t)),r(J(t.isFavorite,t.id))})).catch((function(e){var t;return Le(null===(t=e.response)||void 0===t?void 0:t.status)}));case 3:r(q(!1));case 4:case"end":return a.stop()}}),a)})));return function(e,t,r){return a.apply(this,arguments)}}()}(+!j,"".concat(t))),m(!0))},children:[Object(ne.jsx)("svg",{className:s===c.Property?Ge.icon:Xe.icon,width:s===c.Property?"31":"18",height:s===c.Property?"33":"19","data-testid":_.ButtonSvg,children:Object(ne.jsx)("use",{xlinkHref:"#icon-bookmark"})}),Object(ne.jsx)("span",{className:"visually-hidden",children:j?"In bookmarks":"To bookmarks"})]})},lt=function(e){switch(e){case c.Main:return tt;case c.Favorites:return at;case c.Property:return rt;default:return""}};function ut(e){var t=e.offer,a=e.pageType,n=t.id,i=t.price,s=t.rating,o=t.title,l=t.type,j=t.isPremium,p=t.isFavorite,b=t.previewImage,f=20*Math.round(s),m=Object(d.f)(r.RoomProprety,{id:n}),O=Object(u.b)();return Object(ne.jsxs)("article",{onMouseEnter:function(){return O(Y(n))},onMouseLeave:function(){return O(Y(null))},onClick:function(){return O(Y(null))},className:lt(a),style:{marginTop:"".concat(a===c.Favorites&&"10px")},children:[j&&Object(ne.jsx)(it,{pageType:c.Main}),Object(ne.jsx)("div",{className:"".concat(a,"__image-wrapper place-card__image-wrapper"),children:Object(ne.jsx)(be.a,{to:m,children:Object(ne.jsx)("img",{className:"place-card__image",src:b,width:a===c.Favorites?"150":"260",height:a===c.Favorites?"110":"200",alt:"Place"})})}),Object(ne.jsxs)("div",{className:"place-card__info ".concat(a===c.Favorites&&"favorites__card-info"),children:[Object(ne.jsxs)("div",{className:"place-card__price-wrapper",children:[Object(ne.jsxs)("div",{className:"place-card__price",children:[Object(ne.jsxs)("b",{className:"place-card__price-value",children:["\u20ac",i]}),Object(ne.jsx)("span",{className:"place-card__price-text",children:"/\xa0night"})]}),Object(ne.jsx)(ot,{id:n,isFavorite:p})]}),Object(ne.jsx)("div",{className:"place-card__rating rating",children:Object(ne.jsxs)("div",{className:"place-card__stars rating__stars",children:[Object(ne.jsx)("span",{style:{width:"".concat(f,"%")}}),Object(ne.jsx)("span",{className:"visually-hidden",children:"Rating"})]})}),Object(ne.jsx)("h2",{className:"place-card__name",children:Object(ne.jsx)(be.a,{to:m,children:o})}),Object(ne.jsx)("p",{className:"place-card__type",children:Ae(l)})]})]})}var dt=Object(i.memo)(ut),jt=function(e){switch(e){case c.Main:return Ze;case c.Favorites:return $e;case c.Property:return et;default:return""}};var pt=function(e){var t=e.offers,a=e.pageType;return Object(ne.jsx)("div",{"data-testid":_.OfferListDiv,className:jt(a),children:t.map((function(e){return Object(ne.jsx)(dt,{offer:e,pageType:a},"".concat(e.id).concat(a))}))})};var bt=function(e){var t=e.city,a=Object(u.c)(qe),n=Object(i.useMemo)((function(){return a.filter((function(e){return e.city.name===t}))}),[a,t]),s=Object(u.b)();return 0===n.length?null:Object(ne.jsxs)("li",{className:"favorites__locations-items",children:[Object(ne.jsx)("div",{className:"favorites__locations locations locations--current",children:Object(ne.jsx)("div",{className:"locations__item",children:Object(ne.jsx)(be.a,{to:r.Root,onClick:function(){s(F(t)),s(L(j.Popular))},className:"locations__item-link",href:"#todo",children:Object(ne.jsx)("span",{children:t})})})}),Object(ne.jsx)(pt,{offers:n,pageType:c.Favorites})]})};var ft=function(){return Object(ne.jsxs)("section",{className:"favorites",children:[Object(ne.jsx)("h1",{className:"favorites__title",children:"Saved listing"}),Object(ne.jsx)("ul",{className:"favorites__list",children:Object(Te.a)(b.keys()).map((function(e){return Object(ne.jsx)(bt,{city:e},e)}))})]})};function mt(){return Object(ne.jsx)("div",{className:"header__left",children:Object(ne.jsx)(be.a,{className:"header__logo-link",to:r.Root,children:Object(ne.jsx)("img",{className:"header__logo",src:"img/logo.svg",alt:"6 cities logo",width:"81",height:"41"})})})}var Ot=Object(i.memo)(mt);function ht(){var e=Object(u.c)(Ie),t=Object(u.c)(je),a=Object(d.i)(),c=Object(u.b)();return Object(ne.jsx)("nav",{className:"header__nav",children:Object(ne.jsxs)("ul",{className:"header__nav-list",children:[Object(ne.jsx)("li",{className:"header__nav-item user",children:Object(ne.jsxs)(be.a,{className:"header__nav-link header__nav-link--profile",href:"#todo",to:r.Favorites,children:[Object(ne.jsx)("div",{className:"header__avatar-wrapper user__avatar-wrapper"}),t===n.Auth?Object(ne.jsx)("span",{className:"header__user-name user__name",children:e}):Object(ne.jsx)("span",{className:"header__login",children:"Sign in"})]})}),t===n.Auth&&Object(ne.jsx)("li",{className:"header__nav-item",children:Object(ne.jsx)("a",{className:"header__nav-link",href:"#todo",onClick:function(e){e.preventDefault(),c(function(){var e=Object(Oe.a)(me.a.mark((function e(t,a,r){return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.delete(ie.Logout).then((function(){localStorage.removeItem(Ce),t(S()),t(A(""))})).catch((function(e){var t;return Le(null===(t=e.response)||void 0===t?void 0:t.status)}));case 2:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()),a.pathname===r.Favorites&&c(I(r.Root))},children:Object(ne.jsx)("span",{className:"header__signout",children:"Sign out"})})})]})})}var vt=Object(i.memo)(ht);var _t=function(){var e=Object(u.c)(ae),t=Object(u.c)(qe).length>0,a=Object(u.b)();return Object(i.useEffect)((function(){return a(function(){var e=Object(Oe.a)(me.a.mark((function e(t,a,r){var n,c,i;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(E(!0)),e.prev=1,e.next=4,r.get(ie.Favorite);case 4:n=e.sent,c=n.data,i=c.map(ke),t(W(i)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),_e.b.warning(oe.LoadFiail);case 13:t(E(!1));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,a,r){return e.apply(this,arguments)}}()),function(){a(X())}}),[a]),e?Object(ne.jsx)(ce,{}):Object(ne.jsxs)("div",{className:"page",children:[Object(ne.jsx)("header",{className:"header",children:Object(ne.jsx)("div",{className:"container",children:Object(ne.jsxs)("div",{className:"header__wrapper",children:[Object(ne.jsx)(Ot,{}),Object(ne.jsx)(vt,{})]})})}),Object(ne.jsx)("main",{className:"page__main page__main--favorites",children:Object(ne.jsx)("div",{className:"page__favorites-container container",children:t?Object(ne.jsx)(ft,{}):Object(ne.jsx)(Je,{})})}),Object(ne.jsx)("footer",{className:"footer container",children:Object(ne.jsx)(be.a,{to:r.Root,className:"footer__logo-link",href:"",children:Object(ne.jsx)("img",{className:"footer__logo",src:"img/logo.svg",alt:"6 cities logo",width:"64",height:"33"})})})]})};var xt=function(){var e=Object(u.b)(),t=Object(Te.a)(b.keys()),a=t[Math.floor(Math.random()*t.length)],c=Object(i.useRef)(null),s=Object(i.useRef)(null);return Object(ne.jsxs)("div",{className:"page page--gray page--login",children:[Object(ne.jsx)("header",{className:"header",children:Object(ne.jsx)("div",{className:"container",children:Object(ne.jsx)("div",{className:"header__wrapper",children:Object(ne.jsx)(Ot,{})})})}),Object(ne.jsx)("main",{className:"page__main page__main--login",children:Object(ne.jsxs)("div",{className:"page__login-container container",children:[Object(ne.jsxs)("section",{className:"login",children:[Object(ne.jsx)("h1",{className:"login__title",children:"Sign in"}),Object(ne.jsxs)("form",{className:"login__form form",action:"#",method:"post",onSubmit:function(t){if(t.preventDefault(),null!==c.current&&null!==s.current){if(!f.test(s.current.value))return void _e.b.warning("Invalid password");if(!m.test(c.current.value))return void _e.b.warning("Invalid email");var a={email:c.current.value,password:s.current.value};e(function(e){return function(){var t=Object(Oe.a)(me.a.mark((function t(a,r,c){return me.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(E(!0)),t.next=3,c.post(ie.Login,e).then((function(e){var t=Fe(e.data);Ee(t.token),a(T(n.Auth)),a(A(t.email)),a(B())})).catch((function(e){var t;return Le(null===(t=e.response)||void 0===t?void 0:t.status)}));case 3:a(E(!1));case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}()}(a))}},children:[Object(ne.jsxs)("div",{className:"login__input-wrapper form__input-wrapper",children:[Object(ne.jsx)("label",{className:"visually-hidden",children:"E-mail"}),Object(ne.jsx)("input",{ref:c,className:"login__input form__input",type:"email",name:"email",placeholder:"Email",required:!0,"data-testid":_.LoginEmail})]}),Object(ne.jsxs)("div",{className:"login__input-wrapper form__input-wrapper",children:[Object(ne.jsx)("label",{className:"visually-hidden",children:"Password"}),Object(ne.jsx)("input",{className:"login__input form__input",ref:s,type:"password",name:"password",placeholder:"Password",required:!0,"data-testid":_.LoginPassword})]}),Object(ne.jsx)("button",{className:"login__submit form__submit button",type:"submit","data-testid":_.LoginButton,children:"Sign in"})]})]}),Object(ne.jsx)("section",{className:"locations locations--login locations--current",children:Object(ne.jsx)("div",{className:"locations__item",children:Object(ne.jsx)(be.a,{to:r.Root,onClick:function(){e(F(a)),e(L(j.Popular))},className:"locations__item-link",href:"#todo","data-testid":_.LoginLink,children:Object(ne.jsx)("span",{children:a})})})})]})})]})};function gt(){var e=Object(u.c)(ue),t=Object(u.b)();return Object(ne.jsx)("section",{className:"locations container",children:Object(ne.jsx)("ul",{className:"locations__list tabs__list",children:Object(Te.a)(b.keys()).map((function(a){return Object(ne.jsx)("li",{className:"locations__item",children:Object(ne.jsx)("a",{className:"locations__item-link tabs__item ".concat(e===a&&"tabs__item--active"),onClick:function(e){e.preventDefault(),t(F(a)),t(L(j.Popular))},href:"#todo",children:Object(ne.jsx)("span",{children:a})})},a)}))})})}var yt=Object(i.memo)(gt);function Nt(){var e=Object(u.c)(ue),t=Object(u.c)(de),a=Object.values(j),r=Object(i.useState)(!1),n=Object(st.a)(r,2),c=n[0],s=n[1],o=Object(u.b)();return Object(i.useEffect)((function(){s(!1)}),[e]),Object(ne.jsxs)("form",{className:"places__sorting",action:"#",method:"get",children:[Object(ne.jsx)("span",{className:"places__sorting-caption",children:"Sort by"}),Object(ne.jsxs)("span",{className:"places__sorting-type",tabIndex:0,onClick:function(){return s((function(e){return!e}))},"data-testid":_.Option,children:[t,Object(ne.jsx)("svg",{className:"places__sorting-arrow",width:"7",height:"4",children:Object(ne.jsx)("use",{xlinkHref:"#icon-arrow-select"})})]}),Object(ne.jsx)("ul",{className:"places__options places__options--custom ".concat(c&&"places__options--opened"),children:a.map((function(e){return Object(ne.jsx)("li",{className:"places__option ".concat(e===t&&"places__option--active"),tabIndex:0,onClick:function(){s((function(e){return!e})),o(L(e))},children:e},e)}))})]})}var wt=Object(i.memo)(Nt);var Rt=function(e){var t=e.city,a=Object(u.c)(Ke);return Object(ne.jsxs)("section",{className:"cities__places places",children:[Object(ne.jsx)("h2",{className:"visually-hidden",children:"Places"}),Object(ne.jsxs)("b",{className:"places__found",children:[a.length," places to stay in ",t]}),Object(ne.jsx)(wt,{}),Object(ne.jsx)(pt,{offers:a,pageType:c.Main})]})};var kt=function(e){var t=e.city;return Object(ne.jsx)("section",{className:"cities__no-places",children:Object(ne.jsxs)("div",{className:"cities__status-wrapper tabs__content",children:[Object(ne.jsx)("b",{className:"cities__status",children:"No places to stay available"}),Object(ne.jsxs)("p",{className:"cities__status-description",children:["We could not find any property available at the moment in ",t]})]})})},Pt=a(21);var Ft=function(e,t){var a=Object(i.useState)(null),r=Object(st.a)(a,2),n=r[0],c=r[1];return Object(i.useEffect)((function(){var a=t.location,r=a.latitude,i=a.longitude,s=a.zoom;if(null!==e.current&&null===n){var o=new Pt.Map(e.current,{center:{lat:r,lng:i},zoom:s}),l=new Pt.TileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'});o.addLayer(l),c(o)}}),[e,n,t]),n},Ct=(a(73),"img/pin.svg"),Lt="img/pin-active.svg",Et=new Pt.Icon({iconUrl:Ct,iconSize:[30,40],iconAnchor:[15,40]}),Tt=new Pt.Icon({iconUrl:Lt,iconSize:[30,40],iconAnchor:[15,40]}),St=function(e){return e===c.Main?{height:"550px",width:"512px"}:{height:"579px",width:"1144px",margin:"auto"}};var At=function(e){var t,a=e.offers,n=e.pageType,s=e.city,o=Object(u.c)(pe),l=null!==(t=Object(u.c)(Me).id)&&void 0!==t?t:o,j=b.get(s),p=Object(i.useRef)(null),f=Ft(p,j),m=Object(d.h)();return Object(i.useEffect)((function(){var e=new Pt.LayerGroup;return f&&(a.forEach((function(t){var a=new Pt.Marker({lat:t.location.latitude,lng:t.location.longitude});a.addEventListener("click",(function(){var e=Object(d.f)(r.RoomProprety,{id:t.id});m.push(e)})),a.setIcon(t.id===l?Tt:Et),e.addLayer(a)})),e.addTo(f)),function(){e.remove()}}),[f,a,l,m]),Object(i.useEffect)((function(){var e=j.location,t=e.latitude,a=e.longitude,r=e.zoom;f&&f.flyTo([t,a],r)}),[j,f]),Object(ne.jsx)("section",{className:"".concat(n===c.Main?Qe:Ve," map"),style:St(n),ref:p,"data-testid":_.MapSection})};var It=function(){var e=Object(u.c)(ue),t=Object(u.c)(He),a=Object(u.c)(ae),r=t.length>0;return a?Object(ne.jsx)(ce,{}):Object(ne.jsxs)("div",{className:"page page--gray page--main",children:[Object(ne.jsx)("header",{className:"header",children:Object(ne.jsx)("div",{className:"container",children:Object(ne.jsxs)("div",{className:"header__wrapper",children:[Object(ne.jsx)(Ot,{}),Object(ne.jsx)(vt,{})]})})}),Object(ne.jsxs)("main",{className:"page__main page__main--index ".concat(!r&&"page__main--index-empty"),children:[Object(ne.jsx)("h1",{className:"visually-hidden",children:"Cities"}),Object(ne.jsx)("div",{className:"tabs",children:Object(ne.jsx)(yt,{})}),Object(ne.jsx)("div",{className:"cities",children:Object(ne.jsxs)("div",{className:"cities__places-container container ".concat(!r&&"cities__places-container--empty"),children:[r?Object(ne.jsx)(Rt,{city:e}):Object(ne.jsx)(kt,{city:e}),Object(ne.jsx)("div",{className:"cities__right-section",children:r&&Object(ne.jsx)(At,{offers:t,pageType:c.Main,city:e})})]})})]})]})};var Mt=function(){return Object(ne.jsxs)("div",{className:"page page--gray",children:[Object(ne.jsx)("header",{className:"header",children:Object(ne.jsx)("div",{className:"container",children:Object(ne.jsx)("div",{className:"header__wrapper",children:Object(ne.jsx)(Ot,{})})})}),Object(ne.jsx)("main",{className:"page__main",children:Object(ne.jsxs)("section",{style:{textAlign:"center"},children:[Object(ne.jsx)("h1",{style:{fontSize:"32px",fontWeight:700,fontStyle:"oblique"},children:"404. Page not found"}),Object(ne.jsx)(be.a,{to:r.Root,style:{fontSize:"22px",fontWeight:500,fontStyle:"oblique",color:"#4481c3"},children:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})]})})]})};var zt=function(e){return Object(u.c)(je)===n.Auth?Object(ne.jsx)(d.a,{to:r.Root}):Object(ne.jsx)(d.b,Object(y.a)({},e))};var Ut=function(e){var t=e.exact,a=e.path,c=e.render,i=Object(u.c)(je);return Object(ne.jsx)(d.b,{exact:t,path:a,render:function(){return i===n.Auth?c():Object(ne.jsx)(d.a,{to:r.Login})}})};var Bt=function(e){var t=e.images,a=e.id;return Object(ne.jsx)("div",{className:"property__gallery-container container",children:Object(ne.jsx)("div",{className:"property__gallery",children:t.map((function(e){return Object(ne.jsx)("div",{className:"property__image-wrapper",children:Object(ne.jsx)("img",{className:"property__image",src:e,alt:"Studio"})},a++)}))})})};var qt=function(e){var t=e.goods,a=e.id;return Object(ne.jsxs)("div",{className:"property__inside",children:[Object(ne.jsx)("h2",{className:"property__inside-title",children:"What's inside"}),Object(ne.jsx)("ul",{className:"property__inside-list",children:t.map((function(e){return Object(ne.jsx)("li",{className:"property__inside-item",children:e},a++)}))})]})};var Dt=function(e){var t=e.element,a=e.discription,r=Object(u.c)(Be),n=Object(u.b)();return Object(ne.jsxs)(ne.Fragment,{children:[Object(ne.jsx)("input",{className:"form__rating-input visually-hidden",name:"rating",value:t,id:'"'.concat(t,'-stars"'),type:"radio",checked:t===r,onChange:function(e){return n(H(+e.target.value))}}),Object(ne.jsx)("label",{htmlFor:'"'.concat(t,'-stars"'),className:"reviews__rating-label form__rating-label",title:a,children:Object(ne.jsx)("svg",{className:"form__star-image",width:"37",height:"33",children:Object(ne.jsx)("use",{xlinkHref:"#icon-star"})})})]})};var Ht=function(){var e=Object(u.c)(Me),t=Object(u.c)(ae),a=Object(u.c)(re),r=Object(u.c)(Ue),n=Object(u.c)(Be),c=Object(u.b)(),i=!(r.length>=50&&r.length<=300&&n>0);return Object(ne.jsx)("form",{className:"reviews__form form",action:"#",method:"post",onSubmit:function(t){t.preventDefault(),c(function(e,t){return function(){var a=Object(Oe.a)(me.a.mark((function a(r,n,c){return me.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r(q(!0)),a.next=3,c.post("".concat(ie.Reviews,"/").concat(t),e).then((function(e){var t=e.data.map(Pe);r(D(h)),r(H(v)),r(U(t))})).catch((function(e){var t;return Le(null===(t=e.response)||void 0===t?void 0:t.status)}));case 3:r(q(!1));case 4:case"end":return a.stop()}}),a)})));return function(e,t,r){return a.apply(this,arguments)}}()}({comment:r,rating:n},e.id.toString()))},children:Object(ne.jsxs)("fieldset",{disabled:t||a,children:[Object(ne.jsx)("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),Object(ne.jsx)("div",{className:"reviews__rating-form form__rating",children:Object(Te.a)(O.entries()).map((function(e){var t=Object(st.a)(e,2),a=t[0],r=t[1];return Object(ne.jsx)(Dt,{element:a,discription:r},a)}))}),Object(ne.jsx)("textarea",{onChange:function(e){return c(D(e.target.value))},className:"reviews__textarea form__textarea",id:"review",name:"review",placeholder:"Tell how was your stay, what you like and what can be improved",value:r}),Object(ne.jsxs)("div",{className:"reviews__button-wrapper",children:[Object(ne.jsxs)("p",{className:"reviews__help",children:["To submit review please make sure to set",Object(ne.jsx)("span",{className:"reviews__star",children:"rating"}),"and describe your stay with at least",Object(ne.jsx)("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),Object(ne.jsx)("button",{className:"reviews__submit form__submit button",type:"submit",disabled:i,children:"Submit"})]})]})})},Yt=a(44),Wt=a.n(Yt),Kt=a(34),Jt=a.n(Kt);var Gt=function(e){var t=e.review,a=t.date,r=t.comment,n=t.rating,c=t.user,i=Jt()(a).format("MMMM YYYY"),s=Jt()(a).format("YYYY-MM-DD");return Object(ne.jsxs)("li",{className:"reviews__item",children:[Object(ne.jsxs)("div",{className:"reviews__user user",children:[Object(ne.jsx)("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:Object(ne.jsx)("img",{className:"reviews__avatar user__avatar",src:c.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),Object(ne.jsx)("span",{className:"reviews__user-name",children:c.name})]}),Object(ne.jsxs)("div",{className:"reviews__info",children:[Object(ne.jsx)("div",{className:"reviews__rating rating",children:Object(ne.jsxs)("div",{className:"reviews__stars rating__stars",children:[Object(ne.jsx)("span",{style:{width:"".concat(20*n,"%")}}),Object(ne.jsx)("span",{className:"visually-hidden",children:"Rating"})]})}),Object(ne.jsx)("p",{className:"reviews__text",children:Wt.a.encode(r)}),Object(ne.jsx)("time",{className:"reviews__time",dateTime:s,children:i})]})]})};var Xt=function(){var e=Object(u.c)(je),t=Object(u.c)(Ye);return Object(ne.jsxs)("section",{className:"property__reviews reviews",children:[Object(ne.jsxs)("h2",{className:"reviews__title",children:["Reviews \xb7 ",Object(ne.jsx)("span",{className:"reviews__amount",children:t.length})]}),0!==t.length&&Object(ne.jsx)("ul",{className:"reviews__list",children:t.map((function(e){return Object(ne.jsx)(Gt,{review:e},e.id)}))}),e===n.Auth&&Object(ne.jsx)(Ht,{})]})};var Qt=function(){var e=Object(u.c)(ae),t=Object(d.j)(),a=Object(u.c)(ze),n=Object(u.c)(Me),s=Object(u.c)(We),o=Object(u.b)();Object(i.useEffect)((function(){window.scrollTo(0,0)}),[t]),Object(i.useEffect)((function(){return o(function(e){return function(){var t=Object(Oe.a)(me.a.mark((function t(a,n,c){return me.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(E(!0)),t.next=3,ve.a.all([c.get("".concat(ie.Offers,"/").concat(e)),c.get("".concat(ie.Offers,"/").concat(e).concat(ie.NearbyOffers)),c.get("".concat(ie.Reviews,"/").concat(e))]).then(ve.a.spread((function(e,t,r){var n=ke(e.data),c=t.data.map(ke),i=r.data.map(Pe);a(z(c)),a(M(n)),a(U(i)),a(J(n.isFavorite,n.id))}))).catch((function(e){var t,n;Le(null===(t=e.response)||void 0===t?void 0:t.status),(null===(n=e.response)||void 0===n?void 0:n.status)===se.NotFound&&a(I(r.NotFound))}));case 3:a(E(!1));case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}()}(t.id)),function(){o(G())}}),[o,t.id]);var l=n.isPremium,j=n.id,p=n.images,b=n.title,f=n.rating,m=n.type,O=n.bedrooms,h=n.maxAdults,v=n.price,_=n.goods,x=n.host,g=n.description,y=n.city,N=20*Math.round(f);return!n.id||e?Object(ne.jsx)(ce,{}):Object(ne.jsxs)("div",{className:"page",children:[Object(ne.jsx)("header",{className:"header",children:Object(ne.jsx)("div",{className:"container",children:Object(ne.jsxs)("div",{className:"header__wrapper",children:[Object(ne.jsx)(Ot,{}),Object(ne.jsx)(vt,{})]})})}),Object(ne.jsxs)("main",{className:"page__main page__main--property",children:[Object(ne.jsxs)("section",{className:"property",children:[Object(ne.jsx)(Bt,{images:p,id:j}),Object(ne.jsx)("div",{className:"property__container container",children:Object(ne.jsxs)("div",{className:"property__wrapper",children:[l&&Object(ne.jsx)(it,{pageType:c.Property}),Object(ne.jsxs)("div",{className:"property__name-wrapper",children:[Object(ne.jsx)("h1",{className:"property__name",children:b}),Object(ne.jsx)(ot,{id:j,pageType:c.Property})]}),Object(ne.jsxs)("div",{className:"property__rating rating",children:[Object(ne.jsxs)("div",{className:"property__stars rating__stars",children:[Object(ne.jsx)("span",{style:{width:"".concat(N,"%")}}),Object(ne.jsx)("span",{className:"visually-hidden",children:"Rating"})]}),Object(ne.jsx)("span",{className:"property__rating-value rating__value",children:f})]}),Object(ne.jsxs)("ul",{className:"property__features",children:[Object(ne.jsx)("li",{className:"property__feature property__feature--entire",children:Ae(m)}),Object(ne.jsxs)("li",{className:"property__feature property__feature--bedrooms",children:[O," Bedrooms"]}),Object(ne.jsxs)("li",{className:"property__feature property__feature--adults",children:["Max ",h," adults"]})]}),Object(ne.jsxs)("div",{className:"property__price",children:[Object(ne.jsxs)("b",{className:"property__price-value",children:["\u20ac",v]}),Object(ne.jsx)("span",{className:"property__price-text",children:"\xa0night"})]}),0!==_.length&&Object(ne.jsx)(qt,{goods:_,id:j}),Object(ne.jsxs)("div",{className:"property__host",children:[Object(ne.jsx)("h2",{className:"property__host-title",children:"Meet the host"}),Object(ne.jsxs)("div",{className:"property__host-user user",children:[Object(ne.jsx)("div",{className:"property__avatar-wrapper user__avatar-wrapper ".concat(x.isPro&&"property__avatar-wrapper--pro"),children:Object(ne.jsx)("img",{className:"property__avatar user__avatar",src:x.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),Object(ne.jsx)("span",{className:"property__user-name",children:x.name}),x.isPro&&Object(ne.jsx)("span",{className:"property__user-status",children:"Pro"})]}),Object(ne.jsx)("div",{className:"property__description",children:Object(ne.jsx)("p",{className:"property__text",children:g})})]}),Object(ne.jsx)(Xt,{})]})}),Object(ne.jsx)(At,{offers:s,pageType:c.Property,city:y.name})]}),Object(ne.jsx)("div",{className:"container",children:Object(ne.jsxs)("section",{className:"near-places places",children:[Object(ne.jsx)("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),Object(ne.jsx)(pt,{offers:a,pageType:c.Property})]})})]})]})},Vt=le(_t),Zt=le(xt),$t=le(It),ea=le(Qt);var ta=function(){var e=Object(u.c)(ae);return Object(u.c)(je)===n.Unknown&&e?Object(ne.jsx)(ce,{}):Object(ne.jsxs)(d.d,{children:[Object(ne.jsx)(d.b,{exact:!0,path:r.Root,children:Object(ne.jsx)($t,{})}),Object(ne.jsx)(zt,{exact:!0,path:r.Login,children:Object(ne.jsx)(Zt,{})}),Object(ne.jsx)(Ut,{exact:!0,path:r.Favorites,render:function(){return Object(ne.jsx)(Vt,{})}}),Object(ne.jsx)(d.b,{exact:!0,path:r.RoomProprety,children:Object(ne.jsx)(ea,{})}),Object(ne.jsx)(d.b,{children:Object(ne.jsx)(Mt,{})})]})},aa=a(11),ra=Object(aa.a)({basename:"/1781597-six-cities-8"}),na=function(e){return function(e){return function(t){return t.type===x.RedirectToRoute&&ra.push(t.payload),t.type===x.HistoryBack&&ra.goBack(),e(t)}}},ca=(a(75),function(e){var t=ve.a.create({baseURL:"https://8.react.pages.academy/six-cities",timeout:5e3});return t.interceptors.request.use((function(e){var t=function(){var e;return null!==(e=localStorage.getItem(Ce))&&void 0!==e?e:""}();return t&&(e.headers["X-Token"]=t),e})),t.interceptors.response.use((function(e){return e}),(function(t){var a=t.response;return(null===a||void 0===a?void 0:a.status)===se.Unauthorised&&e(),Promise.reject(t)})),t}((function(){return ia.dispatch(T(n.NoAuth))}))),ia=Object(R.a)({reducer:te,middleware:function(e){return e({thunk:{extraArgument:ca}}).concat(na)}});ia.dispatch(function(){var e=Object(Oe.a)(me.a.mark((function e(t,a,r){var n,c,i;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(E(!0)),e.prev=1,e.next=4,r.get(ie.Offers);case 4:n=e.sent,c=n.data,i=c.map(ke),t(C(i)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),_e.b.warning(oe.LoadFiail);case 13:t(E(!1));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,a,r){return e.apply(this,arguments)}}()),ia.dispatch(function(){var e=Object(Oe.a)(me.a.mark((function e(t,a,r){return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.get(ie.Login).then((function(e){var a=Fe(e.data);Ee(a.token),t(T(n.Auth)),t(A(a.email))})).catch((function(e){var t;return Le(null===(t=e.response)||void 0===t?void 0:t.status)}));case 2:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()),l.a.render(Object(ne.jsx)(s.a.StrictMode,{children:Object(ne.jsx)(u.a,{store:ia,children:Object(ne.jsxs)(d.c,{history:ra,children:[Object(ne.jsx)(_e.a,{}),Object(ne.jsx)(ta,{})]})})}),document.getElementById("root"))}},[[76,1,2]]]);
//# sourceMappingURL=main.17d461c5.chunk.js.map